import anthropic

client = anthropic.Anthropic(
    # defaults to os.environ.get("ANTHROPIC_API_KEY")
    api_key="my_api_key",
)

# Replace placeholders like {{story_summary}} with real values,
# because the SDK does not support variables.
message = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=1000,
    temperature=0,
    messages=[
        {
            "role": "user",
            "content": [
                {
                    "type": "text",
                    "text": "<examples>\n<example>\n<story_summary>\nCinderella suffers under her stepfamily's cruelty. She meets her Fairy Godmother, who helps her attend a royal ball. At the ball, she meets the prince but must leave at midnight. The prince searches for her, and they eventually reunite and live happily ever after.\n</story_summary>\n<ideal_output>\n<story_breakdown>\n1. Protagonist: Cinderella\n\n2. Key emotional events:\n   - Suffering under stepfamily's cruelty\n   - Meeting Fairy Godmother\n   - Attending the ball and meeting the prince\n   - Leaving at midnight\n   - Prince's search\n   - Reunion and happy ending\n\n3. Timeline mapping:\n   0-20%: Suffering under stepfamily\n   20-50%: Meeting Fairy Godmother and preparation for ball\n   50-75%: Ball and meeting the prince\n   75-80%: Midnight departure\n   80-100%: Prince's search and reunion\n\n4. Turning points:\n   - Meeting Fairy Godmother\n   - Attending the ball\n   - Midnight departure\n   - Reunion with the prince\n\n5. Initial emotional assessment: Cinderella starts in a state of unhappiness and oppression, likely around -5 on our scale.\n\n6. Story components:\n\nComponent 1 (0-20%):\n- End time: 20\n- Description: Cinderella suffers under her stepfamily, feeling emotionally stagnant and unhappy.\n- End emotional score: -5\n- Arc: Linear Flat (emotions remain unchanged)\n\nComponent 2 (20-50%):\n- End time: 50\n- Description: Meeting her Fairy Godmother, Cinderella experiences a step-by-step uplift in spirits.\n- End emotional score: -1\n- Arc: Step-by-Step Increase (emotions improve in distinct stages)\n\nComponent 3 (50-75%):\n- End time: 75\n- Description: Her joy at the ball peaks but fades as midnight approaches.\n- End emotional score: 5\n- Arc: Rapid-to-Gradual Increase (emotions rise rapidly, then slow down)\n\nComponent 4 (75-80%):\n- End time: 80\n- Description: The enchantment's abrupt end plunges her back into despair.\n- End emotional score: -3\n- Arc: Straight Decrease (swift, dramatic decline in emotions)\n\nComponent 5 (80-100%):\n- End time: 100\n- Description: The prince's search and their reunion lift Cinderella to peak happiness.\n- End emotional score: 10\n- Arc: Gradual-to-Rapid Increase (emotions rise gradually, then accelerate)\n\n7. Continuity is maintained throughout the components, with each starting where the previous one ended emotionally.\n</story_breakdown>\n\n{\n    \"title\": \"Cinderella\",\n    \"protagonist\": \"Cinderella\",\n    \"story_components\": [\n        {\n            \"end_time\": 0,\n            \"description\": \"#N/A\",\n            \"end_emotional_score\": -5,\n            \"arc\": \"#N/A\"\n        },\n        {\n            \"end_time\": 20,\n            \"description\": \"Cinderella suffers under her stepfamily, feeling emotionally stagnant and unhappy.\",\n            \"end_emotional_score\": -5,\n            \"arc\": \"Linear Flat\"\n        },\n        {\n            \"end_time\": 50,\n            \"description\": \"Meeting her Fairy Godmother, Cinderella experiences a step-by-step uplift in spirits.\",\n            \"end_emotional_score\": -1,\n            \"arc\": \"Step-by-Step Increase\"\n        },\n        {\n            \"end_time\": 75,\n            \"description\": \"Her joy at the ball peaks but fades as midnight approaches.\",\n            \"end_emotional_score\": 5,\n            \"arc\": \"Rapid-to-Gradual Increase\"\n        },\n        {\n            \"end_time\": 80,\n            \"description\": \"The enchantment's abrupt end plunges her back into despair.\",\n            \"end_emotional_score\": -3,\n            \"arc\": \"Straight Decrease\"\n        },\n        {\n            \"end_time\": 100,\n            \"description\": \"The prince's search and their reunion lift Cinderella to peak happiness.\",\n            \"end_emotional_score\": 10,\n            \"arc\": \"Gradual-to-Rapid Increase\"\n        }\n    ]  \n}\n</ideal_output>\n</example>\n<example>\n<story_summary>\nA man falls into a hole and struggles to adapt to his new situation. After initial despair, he gradually regains hope and works towards escaping the hole.\n</story_summary>\n<ideal_output>\n<story_breakdown>\n1. Protagonist: Man\n\n2. Key emotional events:\n   - Falling into the hole\n   - Initial struggle and despair\n   - Gradual adaptation\n   - Regaining hope\n   - Working towards escape\n\n3. Timeline mapping:\n   0-25%: Falling into the hole and initial shock\n   25-50%: Struggling to adapt and despair\n   50-75%: Gradual adaptation and beginning to regain hope\n   75-100%: Working actively towards escape\n\n4. Turning points:\n   - Falling into the hole\n   - Beginning to adapt\n   - Regaining hope\n\n5. Initial emotional assessment: The man likely starts in a neutral or slightly positive state before falling, around 2 on our scale.\n\n6. Story components:\n\nComponent 1 (0-50%):\n- End time: 50\n- Description: The man falls into a hole, plunging into despair and struggling to adapt.\n- End emotional score: -5\n- Arc: Rapid-to-Gradual Decrease (emotions drop sharply, then gradually)\n\nComponent 2 (50-100%):\n- End time: 100\n- Description: Gradually, he regains hope and makes progress towards escape.\n- End emotional score: 2\n- Arc: Gradual-to-Rapid Increase (emotions rise gradually, then accelerate)\n\n7. Continuity is maintained between the two components, with the second starting at the emotional low point where the first ended.\n</story_breakdown>\n\n{\n    \"title\": \"Man in Hole\",\n    \"protagonist\": \"Man\",\n    \"story_components\": [\n        {\n            \"end_time\": 0,\n            \"description\": \"#N/A\",\n            \"end_emotional_score\": 2,\n            \"arc\": \"#N/A\"\n        },\n        {\n            \"end_time\": 50,\n            \"description\": \"The man falls into a hole, plunging into despair and struggling to adapt.\",\n            \"end_emotional_score\": -5,\n            \"arc\": \"Rapid-to-Gradual Decrease\"\n        },\n        {\n            \"end_time\": 100,\n            \"description\": \"Gradually, he regains hope and makes progress towards escape.\",\n            \"end_emotional_score\": 2,\n            \"arc\": \"Gradual-to-Rapid Increase\"\n        }\n    ]\n}\n</ideal_output>\n</example>\n<example>\n<story_summary>\nA boy meets a girl, and his life changes for the better. Their relationship goes through ups and downs, including a breakup, but they eventually reunite in a more mature relationship.\n</story_summary>\n<ideal_output>\n<story_breakdown>\n1. Protagonist: Boy\n\n2. Key emotional events:\n   - Meeting the girl\n   - Relationship development\n   - Experiencing ups and downs\n   - Breakup\n   - Reflection and growth\n   - Reunion\n\n3. Timeline mapping:\n   0-33%: Meeting and initial relationship development\n   33-66%: Relationship strains and breakup\n   66-100%: Reflection, growth, and reunion\n\n4. Turning points:\n   - Meeting the girl\n   - Onset of relationship problems\n   - Breakup\n   - Decision to reunite\n\n5. Initial emotional assessment: The boy likely starts in a neutral state before meeting the girl, around 0 on our scale.\n\n6. Story components:\n\nComponent 1 (0-33%):\n- End time: 33\n- Description: Boy's life changes with the girl's arrival, bringing joy and a new normal.\n- End emotional score: 5\n- Arc: Rapid-to-Gradual Increase (emotions rise rapidly, then slow down)\n\nComponent 2 (33-66%):\n- End time: 66\n- Description: Relationship strains lead to a breakup, causing emotional turmoil.\n- End emotional score: -5\n- Arc: S-Curve Decrease (slow decline, rapid middle, then deceleration)\n\nComponent 3 (66-100%):\n- End time: 100\n- Description: Reflection and renewed communication lead to a happy, mature reunion.\n- End emotional score: 5\n- Arc: Gradual-to-Rapid Increase (emotions rise gradually, then accelerate)\n\n7. Continuity is maintained throughout the components, with each starting where the previous one ended emotionally.\n</story_breakdown>\n\n{\n    \"title\": \"Boy Meets Girl\",\n    \"protagonist\": \"Boy\",\n    \"story_components\": [\n        {\n            \"end_time\": 0,\n            \"description\": \"#N/A\",\n            \"end_emotional_score\": 0,\n            \"arc\": \"N/A\"\n        },\n        {\n            \"end_time\": 33,\n            \"description\": \"Boy's life changes with the girl's arrival, bringing joy and a new normal.\",\n            \"end_emotional_score\": 5,\n            \"arc\": \"Rapid-to-Gradual Increase\"\n        },\n        {\n            \"end_time\": 66,\n            \"description\": \"Relationship strains lead to a breakup, causing emotional turmoil.\",\n            \"end_emotional_score\": -5,\n            \"arc\": \"S-Curve Decrease\"\n        },\n        {\n            \"end_time\": 100,\n            \"description\": \"Reflection and renewed communication lead to a happy, mature reunion.\",\n            \"end_emotional_score\": 5,\n            \"arc\": \"Gradual-to-Rapid Increase\"\n        }\n    ]\n}\n</ideal_output>\n</example>\n<example>\n<story_summary>\nGod creates the universe, Earth, and all living creatures in six days. On the seventh day, God rests.\n</story_summary>\n<ideal_output>\n<story_breakdown>\n1. Protagonist: God\n\n2. Key emotional events:\n   - Creating the universe\n   - Creating Earth\n   - Creating living creatures\n   - Resting on the seventh day\n\n3. Timeline mapping:\n   0-14%: Day 1 - Creating light and separating it from darkness\n   14-28%: Day 2 - Creating the sky\n   28-42%: Day 3 - Creating land, sea, and vegetation\n   42-56%: Day 4 - Creating sun, moon, and stars\n   56-70%: Day 5 - Creating sea creatures and birds\n   70-86%: Day 6 - Creating land animals and humans\n   86-100%: Day 7 - Resting\n\n4. Turning points:\n   - Beginning of creation\n   - Completion of each day's work\n   - Beginning of rest\n\n5. Initial emotional assessment: God likely starts in a neutral state before creation, around 0 on our scale.\n\n6. Story components:\n\nComponent 1 (0-86%):\n- End time: 86\n- Description: Out of nothing God creates the universe, Earth, and all living creatures in six days.\n- End emotional score: 10\n- Arc: Step-by-Step Increase (emotions improve in distinct, noticeable stages with each day of creation)\n\nComponent 2 (86-100%):\n- End time: 100\n- Description: God rested on the seventh day.\n- End emotional score: 10\n- Arc: Linear Flat (emotions remain unchanged at the peak of satisfaction)\n\n7. Continuity is maintained between the two components, with the second starting at the emotional high point where the first ended.\n</story_breakdown>\n\n{\n    \"title\": \"Creation Story\",\n    \"protagonist\": \"God\",\n    \"story_components\": [\n        {\n            \"end_time\": 0,\n            \"description\": \"#N/A\",\n            \"end_emotional_score\": 0,\n            \"arc\": \"\"\n        },\n        {\n            \"end_time\": 86,\n            \"description\": \"Out of nothing God creates the universe, Earth, and all living creatures in six days.\",\n            \"end_emotional_score\": 10,\n            \"arc\": \"Step-by-Step Increase\"\n        },\n        {\n            \"end_time\": 100,\n            \"description\": \"God rested on the seventh day.\",\n            \"end_emotional_score\": 10,\n            \"arc\": \"Linear Flat\"\n        }\n    ]\n}\n</ideal_output>\n</example>\n</examples>\n\n"
                },
                {
                    "type": "text",
                    "text": "Here is the story summary you need to analyze:\n\n<story_summary>\n{{story_summary}}\n</story_summary>\n\nYou are an expert literary analyst tasked with applying Kurt Vonnegut's framework for the shapes of stories to analyze narratives. Your goal is to break down a story into components based on the protagonist's emotional journey and represent this analysis in a structured JSON format.\n\nFramework Overview:\n1. Story Time: View the narrative on a timeline from 0 to 100, representing the percentage of progress through the story.\n2. Story Components: Segment the story into components defined by the protagonist's emotional journey.\n3. Continuity: Ensure each story component starts where the previous one ended for a seamless emotional journey.\n4. Emotional Arcs: Track the protagonist's emotional journey on a scale from euphoric (+10) to depressed (-10).\n\nTypes of Emotional Arcs:\n1. Increase: Emotion improves by the end of the arc\n2. Decrease: Emotion worsens by the end of the arc\n3. Flat: Emotion remains unchanged by the end of the arc\n\nSpecific Emotional Arc Patterns:\n1. Step-by-Step Increase: Emotions improve in distinct, noticeable stages\n2. Step-by-Step Decrease: Emotions deteriorate in distinct, noticeable stages\n3. Linear Increase: Consistent, steady improvement in emotional state\n4. Linear Decrease: Consistent, steady worsening of emotional state\n5. Gradual-to-Rapid Increase: Emotions rise gradually, then accelerate (concave up)\n6. Rapid-to-Gradual Increase: Emotions rise rapidly, then slow down (concave down)\n7. Rapid-to-Gradual Decrease: Emotions drop sharply, then gradually (concave up)\n8. Gradual-to-Rapid Decrease: Emotions drop slowly, then sharply (concave down)\n9. Straight Increase: Sudden, dramatic improvement in emotions\n10. Straight Decrease: Swift, dramatic decline in emotions\n11. S-Curve Increase: Gradual improvement, rapid middle, then deceleration\n12. S-Curve Decrease: Slow decline, rapid middle, then deceleration\n13. Linear Flat: Emotions remain unchanged\n\nAnalysis Steps:\n1. Identify the story's protagonist.\n2. List key emotional events in the story.\n3. Map these events to a timeline from 0 to 100.\n4. Note potential turning points in the emotional journey.\n5. Provide a brief initial emotional assessment of the protagonist at the story's beginning.\n6. Segment the story into components based on major changes in the protagonist's emotions.\n7. For each component:\n   a. Determine the end time (0-100 scale)\n   b. Write a brief description\n   c. Assign an end emotional score (-10 to +10)\n   d. Classify the emotional arc\n8. Ensure continuity between components\n\nOutput Format:\nProvide your analysis as a JSON object with the following structure:\n{\n    \"title\": \"Story Title\",\n    \"protagonist\": \"Protagonist Name\",\n    \"story_components\": [\n        {\n            \"end_time\": 0,\n            \"description\": \"#N/A\",\n            \"end_emotional_score\": initial_score,\n            \"arc\": \"#N/A\"\n        },\n        {\n            \"end_time\": component_end_time,\n            \"description\": \"Brief description of the component\",\n            \"end_emotional_score\": final_emotional_score,\n            \"arc\": \"Type of Emotional Arc\"\n        },\n        // Additional components as needed\n    ]\n}\n\nImportant Notes:\n- The first component always has an end_time of 0 and sets the initial emotional state.\n- Subsequent components build on each other, creating a coherent emotional journey.\n- Ensure that the end_time of the final component is 100.\n- Be consistent with emotional scores and arc classifications throughout the analysis.\n\nBefore providing your final JSON output, wrap your analysis in <story_breakdown> tags to break down your thought process for each step of the analysis. This will help ensure a thorough interpretation of the story."
                }
            ]
        },
        {
            "role": "assistant",
            "content": [
                {
                    "type": "text",
                    "text": "<story_breakdown>"
                }
            ]
        }
    ]
)
print(message.content)